---
import "../styles/global.css";
const { title = "Mete", description = "Engineer • notes & projects" } = Astro.props;
const navItems = [
  { label: "Home", href: "/" },
  { label: "Blog", href: "/blog" },
];
const currentPath = Astro.url.pathname;
const contactLinks = [
  { label: "X", href: "https://twitter.com/metemorris", external: true, aria: "X (Twitter)", icon: "/x.svg" },
  { label: "LinkedIn", href: "https://www.linkedin.com/in/metemorris", external: true, icon: "/linkedin.svg" },
  { label: "RSS", href: "/rss.xml", aria: "RSS Feed", icon: "/rss.svg" },
];
---
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>{title}</title>
    <meta name="description" content={description} />
    <link rel="icon" type="image/png" href="/favicon.png" />
    <script is:inline>
      (function() {
        try {
          const root = document.documentElement;
          const stored = window.localStorage.getItem("theme");
          const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
          const theme = stored ?? (prefersDark ? "dark" : "light");
          root.classList.remove("light", "dark");
          root.classList.add(theme);
        } catch (error) {
          console.error("Theme init failed", error);
        }
      })();
    </script>
  </head>
  <body class="min-h-screen antialiased">
    <div class="mx-auto flex min-h-screen max-w-4xl flex-col gap-16 px-6 py-10">
      <header class="flex flex-wrap items-center justify-between gap-4 border-b border-[var(--page-border)] pb-8">
        <nav class="flex flex-wrap gap-5 text-sm uppercase tracking-[0.3em]">
          {
            navItems.map((item) => (
              <a
                href={item.href}
                class={`px-2 py-1 transition-opacity ${currentPath === item.href ? "opacity-100" : "opacity-50 hover:opacity-80"}`}
              >
                {item.label}
              </a>
            ))
          }
        </nav>
        <button id="theme-toggle" type="button" class="theme-toggle" aria-label="Toggle color mode">
          <span class="sr-only">Toggle color mode</span>
          <span aria-hidden="true" class="theme-toggle__icon theme-toggle__icon--sun">☀︎</span>
          <span aria-hidden="true" class="theme-toggle__icon theme-toggle__icon--moon">☾</span>
          <span aria-hidden="true" class="theme-toggle__thumb"></span>
        </button>
      </header>

      <main class="flex-1">
        <slot />
      </main>
      <footer class="flex flex-wrap items-center gap-3 border-t border-[var(--page-border)] pt-6 text-sm text-[var(--page-muted)]">
        {
          contactLinks.map((link) => (
            <a
              class="contact-link"
              href={link.href}
              target={link.external ? "_blank" : undefined}
              rel={link.external ? "noopener noreferrer" : undefined}
              aria-label={link.aria ?? link.label}
            >
              <span class="contact-link-icon" aria-hidden="true">
                <img src={link.icon} alt="" />
              </span>
              <span>{link.label}</span>
            </a>
          ))
        }
      </footer>
    </div>
    <script is:inline>
      const storageKey = "theme";
      const root = document.documentElement;
      const mediaQuery = window.matchMedia("(prefers-color-scheme: dark)");

      const applyTheme = (theme) => {
        if (theme !== "dark" && theme !== "light") return;
        root.classList.remove("light", "dark");
        root.classList.add(theme);
        const button = document.getElementById("theme-toggle");
        if (button) {
          button.dataset.theme = theme;
          button.setAttribute("aria-label", theme === "dark" ? "Switch to light mode" : "Switch to dark mode");
        }
      };

      const stored = localStorage.getItem(storageKey);
      const initial = stored ?? (mediaQuery.matches ? "dark" : "light");
      applyTheme(initial);

      mediaQuery.addEventListener("change", (event) => {
        const hasStored = localStorage.getItem(storageKey);
        if (!hasStored) {
          applyTheme(event.matches ? "dark" : "light");
        }
      });

      const toggle = () => {
        const current = root.classList.contains("dark") ? "dark" : "light";
        const next = current === "dark" ? "light" : "dark";
        localStorage.setItem(storageKey, next);
        applyTheme(next);
      };

      const initToggle = () => {
        const button = document.getElementById("theme-toggle");
        if (button) {
          const isDark = root.classList.contains("dark");
          button.dataset.theme = isDark ? "dark" : "light";
          button.setAttribute("aria-label", isDark ? "Switch to light mode" : "Switch to dark mode");
          button.addEventListener("click", toggle);
        }
      };

      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", initToggle);
      } else {
        initToggle();
      }
    </script>
  </body>
</html>
