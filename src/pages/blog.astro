---
import Base from "../layouts/Base.astro";
import { getCollection, type CollectionEntry } from "astro:content";

type PostEntry = CollectionEntry<"posts">;
const posts = (await getCollection("posts")) as PostEntry[];
const publishedPosts = posts
  .filter((entry) => !entry.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
---
<Base title="Blog — Mete" description="Writing on reliability, careers, and systems thinking.">
  <div class="space-y-12">
    <section class="space-y-6 fade-in">
      <p class="eyebrow">Latest entries</p>
      <div class="space-y-6">
        {publishedPosts.length === 0 && (
          <p class="muted text-sm border-t border-[var(--page-border)] pt-4">No posts yet — stay tuned.</p>
        )}

        {publishedPosts.map((entry) => (
          <article class="flex flex-col gap-3 border-t border-[var(--page-border)] pt-4 transition-transform duration-200 hover:-translate-y-1">
            <div class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
              <div class="space-y-2">
                <div class="flex flex-wrap items-center gap-2">
                  <a class="text-xl font-semibold hover:underline" href={`/posts/${entry.slug}/`}>
                    {entry.data.title}
                  </a>
                  {entry.data.tags?.length ? (
                    <div class="flex flex-wrap gap-1">
                      {entry.data.tags.map((tag) => (
                        <span class="rounded-full border border-[var(--page-border)] px-2 py-0.5 text-[0.65rem] uppercase tracking-[0.3em] text-[var(--page-muted)]">
                          {tag}
                        </span>
                      ))}
                    </div>
                  ) : null}
                </div>
                <p class="muted text-sm">{entry.data.description}</p>
              </div>
              <time
                class="text-xs uppercase tracking-[0.3em] text-[var(--page-muted)]"
                datetime={entry.data.date.toISOString()}
              >
                {entry.data.date.toLocaleDateString(undefined, { month: "short", day: "numeric", year: "numeric" })}
              </time>
            </div>
          </article>
        ))}
      </div>
    </section>
  </div>
</Base>
